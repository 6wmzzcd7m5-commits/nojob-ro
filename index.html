<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TERMINAL://JOBLESS_RO_V1.2.2</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="visuals.css">
</head>
<body class="lang-en">

<div id="app">
    <header class="panel">
        <div class="flex" style="border-bottom: 1px solid var(--neon); padding-bottom: 5px; margin-bottom: 10px;">
            <div class="flex" style="gap: 5px;">
                <button class="btn-sm" onclick="G.exp()" data-t="save"></button>
                <button class="btn-sm" onclick="G.lang()">SYS_LANG</button>
                <button class="btn-sm btn-red" onclick="G.wipe()">PURGE</button>
            </div>
            <div class="c-n" style="font-weight: bold;">
                LOC://FLOOR_<span id="ui-floor">01</span>
            </div>
        </div>

        <div class="grid g-1">
            <div class="flex">
                <b id="ui-job" class="c-n">LINKING...</b>
                <div class="c-n">LVL_0<span id="ui-lvl">1</span></div>
            </div>
            <div class="flex-col" style="gap: 2px;">
                <div class="flex" style="font-size: 0.6rem; color: var(--hp);">VITALS_HP</div>
                <progress id="hp-bar" value="0" max="100"></progress>
                <div class="flex" style="font-size: 0.6rem; color: var(--sp);">ENERGY_SP</div>
                <progress id="sp-bar" value="0" max="100"></progress>
            </div>
        </div>

        <div class="grid g-6" style="margin-top: 10px;">
            <div class="stat-cell">STR<b id="ui-str">0</b></div>
            <div class="stat-cell">AGI<b id="ui-agi">0</b></div>
            <div class="stat-cell">VIT<b id="ui-vit">0</b></div>
            <div class="stat-cell">INT<b id="ui-int">0</b></div>
            <div class="stat-cell">DEX<b id="ui-dex">0</b></div>
            <div class="stat-cell">LUK<b id="ui-luk">0</b></div>
        </div>
        <div class="grid g-5" style="margin-top: 5px; background: rgba(57, 255, 20, 0.05);">
            <div class="stat-cell">ATK<span id="ui-atk">0</span></div>
            <div class="stat-cell">MATK<span id="ui-matk">0</span></div>
            <div class="stat-cell">HIT<span id="ui-hit">0</span></div>
            <div class="stat-cell">FLEE<span id="ui-flee">0</span></div>
            <div class="stat-cell">CRI<span id="ui-cri">0%</span></div>
        </div>
    </header>

    <section id="battle-ui" class="panel" style="border-style: dashed; border-color: var(--hp);" hidden>
        <div id="ui-target" style="text-align: center; font-size: 0.7rem; color: var(--hp); margin-bottom: 5px;">ENCOUNTER_ACTIVE</div>
        <div class="flex-col" style="gap: 5px;">
            <div class="flex" style="font-size: 0.6rem;">USR_SYNC <progress id="atb-p" value="0" max="100" style="width: 70%;"></progress></div>
            <div class="flex" style="font-size: 0.6rem;">FOE_SYNC <progress id="atb-e" value="0" max="100" style="width: 70%;"></progress></div>
        </div>
    </section>

    <section id="stage" class="panel">
        <div id="p-box" class="avatar-box">
            <div id="p-spr" class="spr"><div class="hd"></div><div class="bd"></div></div>
        </div>
        <div id="e-box" class="avatar-box">
            <div id="e-spr" class="spr"><div class="hd"></div><div class="bd"></div></div>
        </div>
    </section>

    <main id="ctl" class="grid">
        <button style="grid-column: span 2; padding: 30px; font-size: 1.2rem;" onclick="G.init()" data-t="start"></button>
    </main>

    <footer id="log" class="panel"></footer>
</div>

<script>
/**
 * JOBLESS_RO_CORE v1.2.2
 * Cyber-Terminal Implementation
 */
const DB = {
    jobs: {
        'Novice': { next:['Swordman','Mage','Thief'], pool:['First Aid'], hp:60, sp:20, stats:[2,2,2,1,1,1] },
        'Swordman': { next:['Knight'], pool:['Bash'], hp:150, sp:40, stats:[5,3,4,1,2,1] },
        'Mage': { next:['Wizard'], pool:['Fire Bolt'], hp:80, sp:100, stats:[1,4,2,8,3,1] },
        'Thief': { next:['Assassin'], pool:['Envenom'], hp:100, sp:50, stats:[4,6,2,2,4,2] }
    },
    skills: { 
        'First Aid': {sp:3, val:20, type:'heal'}, 
        'Bash': {sp:8, val:1.5, type:'phys'}, 
        'Fire Bolt': {sp:10, val:1.8, type:'mag'}, 
        'Envenom': {sp:10, val:1.2, type:'phys'} 
    },
    mobs: [ 
        [{n:'Poring',hp:35,atk:10,xp:10},{n:'Lunatic',hp:50,atk:14,xp:15}], 
        [{n:'Wolf',hp:250,atk:38,xp:65},{n:'Skeleton',hp:300,atk:48,xp:85}] 
    ]
};

const el = i => document.getElementById(i);

const G = {
    p: null, 
    s: { f:1, b:false, tm:null, l:'en', patb:0, eatb:0 },

    init() {
        const saved = localStorage.getItem('ro_rouge_v121');
        if (saved) {
            try { this.p = JSON.parse(atob(saved)); this.loadScene('mnu'); } 
            catch(e) { this.loadScene('reg'); }
        } else { this.loadScene('reg'); }
    },

    async loadScene(name) {
        try {
            const res = await fetch(`./scenes/${name}.html`);
            const html = await res.text();
            el('ctl').innerHTML = html;
            el('ctl').querySelectorAll('script').forEach(s => {
                const n = document.createElement('script');
                n.textContent = s.textContent;
                document.head.appendChild(n).parentNode.removeChild(n);
            });
            this.render();
        } catch(e) {
            el('ctl').innerHTML = `<button onclick="G.init()">ERROR_RETRY_LINK</button>`;
        }
    },

    render() {
        if(!this.p) return;
        el('ui-job').innerText = this.p.job.toUpperCase();
        el('ui-lvl').innerText = this.p.lvl.toString().padStart(2, '0');
        el('ui-floor').innerText = this.s.f.toString().padStart(2, '0');
        el('ui-pots').innerText = this.p.pots;
        
        el('hp-bar').value = this.p.hp; el('hp-bar').max = this.p.mh;
        el('sp-bar').value = this.p.sp; el('sp-bar').max = this.p.msp;

        ['str','agi','vit','int','dex','luk'].forEach(k => el('ui-'+k).innerText = this.p[k]);

        // Formulas
        el('ui-atk').innerText = Math.floor(this.p.str * 2.5 + this.p.lvl * 2);
        el('ui-matk').innerText = Math.floor(this.p.int * 3 + this.p.lvl * 2);
        el('ui-hit').innerText = this.p.dex + this.p.lvl;
        el('ui-flee').innerText = this.p.agi + this.p.lvl;
        el('ui-cri').innerText = Math.floor(this.p.luk * 0.5) + '%';

        el('battle-ui').hidden = !this.s.b;
        el('p-spr').className = `spr j-${this.p.job}`;
        el('stage').style.filter = 'none';
    },

    triggerWarning(cb) {
        G.log("⚠️ CRITICAL_THREAT_DETECTED", "c-red");
        const stage = el('stage');
        const warn = document.createElement('div');
        warn.className = 'warning-overlay';
        warn.innerHTML = '<div class="warning-text">BOSS_WARNING</div>';
        stage.appendChild(warn);
        setTimeout(() => { warn.remove(); if(cb) cb(); }, 1500);
    },

    bt(mob) {
        this.s.mob = { ...mob, mhp: mob.hp };
        this.loadScene('btl');
    },

    sv() { localStorage.setItem('ro_rouge_v121', btoa(JSON.stringify(this.p))); },
    wipe() { if(confirm("PURGE ALL DATA?")){ localStorage.clear(); location.reload(); } },
    lang() { this.s.l = this.s.l === 'en' ? 'cn' : 'en'; document.body.className = 'lang-' + this.s.l; },
    log(m, c='') {
        const l = el('log');
        l.insertAdjacentHTML('afterbegin', `<div class="entry ${c}">[SYS]: ${m}</div>`);
        if(l.children.length > 5) l.lastElementChild.remove();
    },
    exp() {
        const data = btoa(JSON.stringify(this.p));
        const a = document.createElement('a');
        a.href = 'data:text/plain;base64,' + data;
        a.download = `CHAR_${this.p.n}.jro`;
        a.click();
    }
};
</script>
</body>
</html>
