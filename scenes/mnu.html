<div class="panel grid g-1" style="grid-column: span 2; text-align: center;">
    <div style="padding: 10px 0;">
        <h4 class="c-n" style="margin: 0; letter-spacing: 2px;">
            <span class="en">COMMAND_CENTER</span>
            <span class="cn">指令中心</span>
        </h4>
        <p style="font-size: 0.7rem; color: #555;">SYSTEM_STATUS: STABLE</p>
    </div>

    <button onclick="mnu.warp()" style="padding: 30px 10px; border-width: 2px;">
        <span class="en">WARP_TO_FLOOR_<span class="f-num"></span></span>
        <span class="cn">傳送至第 <span class="f-num"></span> 層</span>
    </button>

    <button onclick="mnu.rest()" class="btn-sm" style="width: 100%; margin-top: 10px;">
        <span class="en">INN_REST (FULL_RECOVERY)</span>
        <span class="cn">旅店休息 (完全恢復)</span>
    </button>

    <div id="job-change-box" style="display: none; margin-top: 15px; border-top: 1px dashed var(--neon); padding-top: 15px;">
        <p class="c-yel" style="font-size: 0.8rem; font-weight: bold;">[!] JOB_EVOLUTION_AVAILABLE</p>
        <div id="job-options" class="grid g-1"></div>
    </div>
</div>

<script>
// Update the floor display on the buttons
document.querySelectorAll('.f-num').forEach(e => e.innerText = G.s.f.toString().padStart(2, '0'));

const mnu = {
    // Warp logic: Check if it's an MVP floor to trigger a warning
    warp() {
        if (G.s.f % 10 === 0) {
            G.triggerWarning(() => G.loadScene('btl'));
        } else {
            G.loadScene('btl');
        }
    },

    // Recovery logic: Costs nothing in this roguelike build for now
    rest() {
        G.p.hp = G.p.mh;
        G.p.sp = G.p.msp;
        G.render();
        G.log("RECOVERY_SYNC_COMPLETE", "c-n");
    },

    // Check for Job advancement
    checkJob() {
        const currentJobData = window.DB_JOBS[G.p.job];
        // Trigger job change at Level 10 (1st Job) and Level 40 (2nd Job)
        if (currentJobData && currentJobData.next.length > 0) {
            if ((G.p.job === 'Novice' && G.p.lvl >= 10) || (G.p.lvl >= 40)) {
                const box = el('job-change-box');
                const opt = el('job-options');
                box.style.display = 'block';
                opt.innerHTML = '';
                
                currentJobData.next.forEach(j => {
                    const b = document.createElement('button');
                    b.className = 'btn-sm';
                    b.style.borderColor = 'var(--rare)';
                    b.innerText = `EVOLVE_TO_${j.toUpperCase()}`;
                    b.onclick = () => this.evolve(j);
                    opt.appendChild(b);
                });
            }
        }
    },

    evolve(newJob) {
        const jobData = window.DB_JOBS[newJob];
        G.p.job = newJob;
        // Apply Job Bonuses
        G.p.mh += jobData.hp;
        G.p.msp += jobData.sp;
        G.p.hp = G.p.mh;
        G.p.sp = G.p.msp;
        // Boost Stats
        G.p.str += jobData.stats[0];
        G.p.agi += jobData.stats[1];
        G.p.vit += jobData.stats[2];
        G.p.int += jobData.stats[3];
        G.p.dex += jobData.stats[4];
        G.p.luk += jobData.stats[5];
        
        G.log(`EVOLUTION_SUCCESS: ${newJob.toUpperCase()}`, "c-rare");
        G.sv();
        G.loadScene('mnu');
    }
};

mnu.checkJob();
</script>
