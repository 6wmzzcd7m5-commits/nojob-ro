<div class="panel grid g-1" style="grid-column: span 2; text-align: center; border-color: var(--rare);">
    <div style="padding: 10px 0;">
        <h3 class="c-n" style="margin: 0; letter-spacing: 4px; text-shadow: 0 0 10px var(--glow);">
            <span class="en">LEVEL_UP_REWARD</span>
            <span class="cn">等級提升獎勵</span>
        </h3>
        <p style="font-size: 0.7rem; color: #666; margin-top: 5px;">[ SELECT ONE UPGRADE TO INTEGRATE ]</p>
    </div>

    <div id="reward-list" class="grid g-1"></div>
    
    <div style="margin-top: 15px; font-size: 0.6rem; color: #444; letter-spacing: 1px;">
        DATA_SYNC_PENDING_SELECTION...
    </div>
</div>

<script>
const rewardScene = {
    init() {
        // 1. Generate 3 random choices using the Item DB logic
        const draft = window.generateDraft();
        const container = el('reward-list');
        
        draft.forEach(item => {
            const card = document.createElement('div');
            // Apply special styling if it's a Rare Monster Card
            card.className = `choice-card ${item.cat === 'card' ? 'rare' : ''}`;
            
            let flavor = item.cat.toUpperCase();
            let title = item.n;
            let desc = item.desc || "STRENGTHENS_THE_VESSEL";

            card.innerHTML = `
                <div style="font-size: 0.6rem; opacity: 0.6; margin-bottom: 5px;">// ${flavor}</div>
                <div style="font-weight: bold; font-size: 1.1rem; color: var(--neon);">${title}</div>
                <div style="font-size: 0.75rem; color: #888; margin-top: 8px; line-height: 1.2;">${desc}</div>
            `;

            card.onclick = () => this.claim(item);
            container.appendChild(card);
        });
        
        G.log("REWARD_DRAFT_GENERATED", "c-n");
    },

    claim(item) {
        // --- 1. HANDLE SKILLS ---
        if (item.cat === 'skill') {
            // Adds to the auto-proc pool in btl.html
            G.p.sk[item.n] = (G.p.sk[item.n] || 0) + 1;
            G.log(`SKILL_INTEGRATED: ${item.n}`, "c-rare");
        } 
        // --- 2. HANDLE ITEMS & CARDS ---
        else if (item.cat === 'item' || item.cat === 'card') {
            if (item.type === 'heal') {
                G.p.hp = Math.min(G.p.mh, G.p.hp + item.val);
            } else if (item.type === 'full') {
                G.p.hp = G.p.mh; 
                G.p.sp = G.p.msp;
            } else {
                // Apply permanent stat bonus
                // (Matches stats: str, agi, vit, int, dex, luk, mh, msp)
                G.p[item.stat] += item.val;
                
                // If Max HP/SP increased, give current HP/SP a boost too
                if (item.stat === 'mh') G.p.hp += item.val;
                if (item.stat === 'msp') G.p.sp += item.val;
            }
            G.log(`RELIQ_SYNCHRONIZED: ${item.n}`, "c-n");
        }

        // Save progress and return to Hub
        G.sv();
        G.loadScene('mnu');
    }
};

// Start scene logic
rewardScene.init();
</script>
