<div class="panel grid" style="grid-column: span 2; gap: 15px; text-align: center;">
    <h2 class="c-yel" style="margin: 0; text-shadow: 0 0 10px rgba(255,215,0,0.5);">
        <span class="en">LEVEL UP REWARD</span>
        <span class="cn">升級獎勵</span>
    </h2>

    <p style="font-size: 0.9rem; margin-bottom: 5px;">
        <span class="en">Select one blessing for your journey:</span>
        <span class="cn">請選擇一項冒險加護：</span>
    </p>

    <div id="reward-container" class="grid g-1" style="gap: 10px;">
        </div>
</div>

<script>
/**
 * REWARD POOL LOGIC
 * Merged from v3 engine: Skill learning and Supply restoration.
 * Integrates v1.2.2 Manual Stat Point system.
 */
(function() {
    const container = document.getElementById('reward-container');
    
    // Helper to create a reward card
    const createReward = (titleEn, titleCn, descEn, descCn, color, fn) => {
        const btn = document.createElement('button');
        btn.className = "btn-neon reward-btn";
        btn.style.borderColor = color;
        btn.innerHTML = `
            <div style="font-weight:bold; font-size:1.1rem;">
                <span class="en">${titleEn}</span><span class="cn">${titleCn}</span>
            </div>
            <div style="font-size:0.75rem; opacity:0.8; margin-top:4px;">
                <span class="en">${descEn}</span><span class="cn">${descCn}</span>
            </div>
        `;
        btn.onclick = () => {
            fn();
            G.sv(); // Auto-save after choosing
        };
        container.appendChild(btn);
    };

    // --- OPTION 1: SKILL (From Job Pool) ---
    const currentJobData = DB.jobs[G.p.job];
    const availableSkills = currentJobData.pool.filter(s => !G.p.sk[s]);
    
    if (availableSkills.length > 0) {
        const nextSkill = availableSkills[0];
        createReward(
            `LEARN: ${nextSkill}`, `學習：${nextSkill}`,
            "Expand your combat options.", "擴展你的戰鬥手段。",
            "var(--sp)",
            () => { 
                G.p.sk[nextSkill] = 1;
                G.log(`Learned ${nextSkill}!`, 'c-n');
                G.loadScene('mnu'); 
            }
        );
    } else {
        // Fallback if all job skills are learned
        createReward(
            "MASTERY", "精通",
            "Gain +1 to all base stats.", "所有基礎屬性 +1。",
            "#fff",
            () => {
                ['str','agi','vit','int','dex','luk'].forEach(s => G.p[s]++);
                G.log("Mastery attained: All stats +1", 'c-n');
                G.loadScene('mnu');
            }
        );
    }

    // --- OPTION 2: STAT POINTS (Manual Allocation) ---
    createReward(
        "STAT POINTS", "屬性點數",
        "Gain +5 points for manual growth.", "獲得 5 點自由分配屬性。",
        "var(--c-n)",
        () => {
            G.p.pts += 5;
            G.log("Gained 5 Stat Points", 'c-n');
            G.loadScene('stat'); // Redirect to manual allocation scene
        }
    );

    // --- OPTION 3: SUPPLIES (Potions) ---
    createReward(
        "SUPPLIES", "補給物資",
        "Restock +2 HP Potions.", "補給 2 瓶生命藥水。",
        "var(--hp)",
        () => {
            G.p.pots += 2;
            G.log("Supplies restocked", 'c-yel');
            G.loadScene('mnu');
        }
    );

})();
</script>
